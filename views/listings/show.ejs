<% layout("/layouts/boilerplate.ejs") %>

<style>
/* Basic Reset */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
.listing-header {
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.listing-header h1 {
  margin-right: 5rem;
  background-color: #f4f7f8;
  border: 1px solid rgb(236, 232, 232);
  border-radius: 10px;
  padding: 10px;
  margin-top: 1rem;
  font-weight: 700;    
  color: #007bff;             
  margin-bottom: 20px;        
  text-transform: uppercase;   
  letter-spacing: 2px;         
  line-height: 1.2;
}

.back-btn {
  background-color: #555;
  color: #fff;
  padding: 8px 12px;
  border-radius: 5px;
  text-decoration: none;
  font-weight: 600;
  transition: 0.3s;
}

.back-btn:hover {
  background-color: #007bff;
}

/* Listing image */
.listing-image img {
  width: 100%;
  max-width: 900px;
  height: 500px;
  display: block;
  margin: 20px auto;
  border-radius: 15px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.1);
  transition: transform 0.3s ease;
}

.listing-image img:hover {
  transform: scale(1.03);
}

/* Listing details */
.listing-details {
  list-style: none;
  margin: 20px 0;
  padding: 0;
  max-width: 700px;
  margin-left: auto;
  margin-right: auto;
}

.listing-details li {
  background: #fff;
  margin-bottom: 12px;
  padding: 12px 15px;
  border-radius: 10px;
  box-shadow: 0 6px 15px rgba(0,0,0,0.05);
  font-size: 1rem;
  transition: transform 0.2s ease;
}

.listing-details li:hover {
  transform: translateY(-2px);
}

/* Action buttons */
.edit-delete {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: center;
  gap: 20px;
}
.edit-btn, .delete-btn{
    margin: 10px 10px 20px 0;
  padding: 10px 18px;
  font-size: 1rem;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  transition: 0.3s;
  text-decoration: none;
}
.delete-form{
  background-color: none;
}
.edit-btn {
  background-color: #28a745;
  color: #fff;
}

.edit-btn i {
  margin-right: 5px;
}

.edit-btn:hover {
  background-color: #218838;
}

.delete-btn {
  background-color: #dc3545;
  color: #fff;
}

.delete-btn:hover {
  background-color: #c82333;
}

/* Reviews section */
h4 {
  text-align: center;
  margin-top: 30px;
  color: #007bff;
  margin-bottom: 20px;        
  text-transform: uppercase;   
  letter-spacing: 2px;         
  line-height: 1.2;
  font-weight: 700;
}

/* Review form */
.review-form {
  max-width: 700px;
  margin: 15px auto 30px auto;
  padding: 20px;
  background: #fff;
  border-radius: 15px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.05);
}

form label {
  font-weight: 600;
  display: block;
  margin-bottom: 8px;
}

textarea, input {
  width: 100%;
  padding: 10px 12px;
  margin-bottom: 12px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 1rem;
}

textarea:focus, input:focus {
  outline: none;
  border-color: #007bff;
  box-shadow: 0 0 5px rgba(0,123,255,0.3);
}

button.btn {
  background-color: #007bff;
  color: #fff;
  border: none;
  padding: 10px 18px;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.3s;
  width: 100%;
  font-size: 1rem;
}

button.btn:hover {
  background-color: #0056b3;
}

/* Reviews cards */
.card-body {
  background: #fff;
  /* margin-left: -30px; */
  /* padding: 15px 20px; */
  border-radius: 12px;
  box-shadow: 0 6px 15px rgba(0,0,0,0.05);
  transition: transform 0.2s ease;
}

.card-body:hover {
  transform: translateY(-3px);
}
.card-body p{
  margin-bottom: 1rem;
}
.card-title {
  font-weight: 700;
  color: #007bff;
  margin-bottom: 1rem;
}

.card-text {
  margin-top: 2rem;
  font-size: 0.95rem;
  line-height: 1.4;
}

.card-body form button {
  background-color: #dc3545;
  width: 80px;
  padding: 10px;
  font-size: 1rem;
  margin-top: 1rem;
}

.card-body form button:hover {
  background-color: #c82333;
}


/* Responsive Design */
@media (max-width: 768px) {
  .listing-details, form {
    padding: 15px;
  }

  h1 {
    font-size: 2rem;
  }
}

@media (max-width: 480px) {
  h1 {
    font-size: 1.7rem;
  }

  .edit-btn, .delete-btn, button.btn {
    width: 100%;
    margin-bottom: 10px;
  }
}
</style>


<body>
      <div class="listing-header">
  <h1><%= listing.title %></h1>
  <a href="/listing" class="back-btn">
    <i class="fa fa-arrow-left"></i> Back to Listings
  </a>
</div>
      <% if(listing.image) { %>
      <div class="listing-image">
        <img src="<%= listing.image.url %>" alt="<%= listing.title %>" />
      </div>
      <% } %>
      <ul class="listing-details">
        <li><strong>Owner:</strong> <%= listing.owner.username %></li>
        <li><strong>Description:</strong> <%= listing.description %></li>
        <li><strong>Price:</strong> $<%= listing.price %></li>
        <li><strong>Location:</strong> <%= listing.location %></li>
        <li><strong>Country:</strong> <%= listing.country %></li>
        <li><strong>Category:</strong> <%= listing.category.charAt(0).toUpperCase() + listing.category.slice(1) %></li>
      </ul>
       <div class="edit-delete">
        <div class="edit-div">
        <a href="/listing/<%= listing._id %>/edit" class="edit-btn">
          <i class="fa fa-edit"></i> Edit Listing</a>
          </div>
          <div class="delete-div">
        <form action="/listing/<%= listing._id %>?_method=DELETE" method="post" class="delete-form">
          <button type="submit" class="delete-btn">
            <i class="fa fa-trash"></i> Delete Listing
          </button>
        </form>
        </div>
</div>
      <% if(currUser) {%>
      <h4>Leave a Review</h4>
      <form
        action="/listing/<%= listing._id %>/review"
        method="POST"
        novalidate
        class="needs-validation review-form"
      >
 <div class="mb-3 mt-3">
<label for="rating" class="form-label">Rating</label>
<fieldset class="starability-slot">
  <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="1" checked aria-label="No rating." />
  <input type="radio" id="first-rate1" name="review[rating]" value="1" />
  <label for="first-rate1" title="Terrible">1 star</label>
  <input type="radio" id="first-rate2" name="review[rating]" value="2" />
  <label for="first-rate2" title="Not good">2 stars</label>
  <input type="radio" id="first-rate3" name="review[rating]" value="3" />
  <label for="first-rate3" title="Average">3 stars</label>
  <input type="radio" id="first-rate4" name="review[rating]" value="4" />
  <label for="first-rate4" title="Very good">4 stars</label>
  <input type="radio" id="first-rate5" name="review[rating]" value="5" />
  <label for="first-rate5" title="Amazing">5 stars</label>
</fieldset>
</div>
        <div class="mb-3 mt-3">
          <label for="comment" class="form-label">Comment</label>
          <textarea
            name="review[comment]"
            id="comment"
            rows="8"
            class="form-control"
            cols="70"
            required
          ></textarea>
          <div class="invalid-feedback">please enter valid review</div>
        </div>
        <br />
        <button class="btn btn-outline-dark">submit</button>
      </form>
<% } %>
      <h4>All Reviews</h4>
      <ul>
        <div class="row">
          <% for(review of listing.reviews) {%>
          
            <div class="card-body">
              <h5 class="card-title"><%= review.author.username %></h5>
               <p class="starability-result card-text" data-rating="<%= review.rating %>">
              </p>
              <p class="card-text"><%= review.comment %></p>
            <form
              action="/listing/<%= listing._id %>/review/<%= review._id %>?_method=DELETE"
              class="mb-3"
              method="post"
            >
              <button class="btn btn-sm btn-dark">Delete</button>
            </form>
          </div>
          <% } %>
        </div>
      </ul>
    </div>
  </div>
</body>
